Title: New Blog
Tags: pelican, python, blog, travis-ci

Ok, this is my attempt to create a new blog using [github](github.io) pages, [Pelican](http://docs.getpelican.com/en/3.6.3/), [Travis CI](). I used to have a quite old fashioned blog ([mikrohelen.net](http://mikrohelen.net)), which I haven't touched for ages. So, I wanted to move on. I'm using heavily github so I found it an appealing option. I also develop in Python and I wanted a familiar framework to work with for blogging. After a bit of research, I ended up following the tutorials from [cyrille.rossant.net](http://cyrille.rossant.net/pelican-github/), [crunk.io](http://crunk.io/post/introduction-to-pelican/) and a few others to setup my blog on github with the Pelican framework. 

## Step 1: Create a github repository based on your github username
This is for setting up the website. Follow the steps from https://pages.github.com/. Mine is in [elenimikro/elenimikro.github.io](https://github.com/elenimikro/elenimikro.github.io)

## Step 2: Clone the repo and Setup Pelican 
First clone the repo in your machine
```shell
$ git clone git@github.com:username/username.github.io.git
```
Then setup Pelican in the local folder - It's better to use a clean environment to do that using [virtualenvs](http://docs.python-guide.org/en/latest/dev/virtualenvs/)
```shell
$ pip install pelican
$ pip install pelican-markdown
```

follow the instructions in [Installing Pelican](http://docs.getpelican.com/en/3.6.3/install.html) for installing and creating some content.

## Step 3: Configure Pelican 
My blog structure looks like this:
```shell
content/
    pages/
        about.md
    assets/
    images/
    2016-09-18-hello-world.md
output/
pelican-plugins/
themes/
Makefile
pelicanconf.py 
publishconf.py
requirements.txt
.travis.yml
```
Pelican can understand the different pages you want to include in the blog like the `about.md`. These are placed under `content/pages/`. All the posts can be placed in `content` and I have the `assets` folder for adding other images and resources that I need fo the blog. 
 
The Makefile is generated automatically during the wizard for generating the blog. If you want to edit the options this is the file to edit. 

The `requirements.txt` contains all the python depedencies for building the blog. The `.travis.yml` is the yaml file for building with Travis CI (see below for more info). 

The `pelicanconf.py` is the config file for the blog. The `publishconf.py` is invoked for publishing the blog. These are generated automatically but you'll have to tweak them a bit to set them up with your website. 

Some things from my configurations file (`pelicanconf.py`):
I got from [crunk.io](http://crunk.io/post/introduction-to-pelican/) the setup of clean URLs:
```python
#clean URLs
ARTICLE_URL = '{slug}/'
ARTICLE_SAVE_AS = '{slug}/index.html'
PAGE_URL = '{slug}/'
PAGE_SAVE_AS = '{slug}/index.html'
```
His post also has some useful info for setting the `MD_EXTENSIONS` setting. 

### Pelican Plugins 
The `pelican-plugins` contains all the plugins from https://github.com/getpelican/pelican-plugins. You can define it as a submodule or generate it on the fly when building with Travis. 

### Theme
In the `themes/` folder you place the selected pelican theme. I've used the [Pure Single](https://github.com/PurePelicanTheme/pure-single) theme. 

##Step 4: Building with Travis 
Setting up Travis was a bit tricky for me. There are different approaches for publishing the static pages. There is one approach where you create two repositories: one for the code and one for the static pages (the actual https://username.github.io website). I instead used the approach of having two branches in the [username.github.io](https://github.com/elenimikro/elenimikro.github.io) repository, a `source` one where the source code goes and the `master`. I set it up to build with Travis CI and after a succesfull installation to invoke the Makefile for deploying the pages to the `master` branch. 

### Create the yaml file 
My `.travis.yml` files looks like this:
```yaml
language: python
python: 
- "2.7"
sudo: required
branches:
  only:
  - source
env:
  global:
    secure: "XXXXXX"
install:
- pip install -r requirements.txt
- pip install ghp-import
- git clone https://github.com/getpelican/pelican-plugins
script:
- make publish github
```

The env block is added by the travis tool, so don't include it in the original yaml file. Login to Github to get an [Authentication Token](https://help.github.com/articles/creating-an-access-token-for-command-line-use/). Make sure the token has access to the repo:
![Github Authentication Token for Travis CI]({filename}/images/Github-Travis-2016-09-18.png)


In your local project, install the travis command line tool with:
```shell
$ sudo apt-get install ruby1.9.1-dev
$ sudo gem install travis
```
and run from inside the repository:
```
$ travis encrypt GH_TOKEN=TOKENFROMGITHUB --add env.global 
```
This adds the `env.global` configuration in the `.travis.yml`. 

Also in the Travis CI project setup in the settings the follwing two variables:
![Travis CI settings]({filename}/images/Travis-CI-2016-09-18.png)

The `GH_TOKEN` is your github Authentication Token for Travis CI. 

## Step 5: edit Makefile
Edit the `Makefile` on the `github publish` section to look like this:
```C
#Edited the following lines to publish via travis
github: publish
    ghp-import -n $(OUTPUTDIR) -b master -m "Generated by Travis"
    git push -fq https://${GH_TOKEN}@github.com/$(TRAVIS_REPO_SLUG).git master
```

## Step 6: Commit, build and deploy
Commit and push the blog structure in the `source`  branch of the repository. If the setup is successful it will trigger the Travis CI job, which will generate the static files and publish them in the `master` branch. 

My master branch structure like this: https://github.com/elenimikro/elenimikro.github.io/tree/master. The pages are automatically served in https://elenimikro.github.io. 

## Things To Do
This is quite primitive yet. I need to setup DISQUS and get cracking with some more content. 